"use strict";(self["webpackChunkDTX_MEDI_PLATFORM"]=self["webpackChunkDTX_MEDI_PLATFORM"]||[]).push([[50],{43365:function(t,e,s){s.r(e),s.d(e,{default:function(){return W}});var i=function(){var t=this,e=t._self._c;return e("main",{staticClass:"prescription"},[e("PrescriptionTemplatePopup",{attrs:{prescriptionPopFlag:t.prescriptionPopFlag,prescriptionTemList:t.prescriptionTemList},on:{prescriptionTemPopClose:t.prescriptionTemPopClose,setPrescriptionTem:t.setPrescriptionTem}}),e("TemplateSavePopup",{attrs:{popupEventFlag:t.savePopFlag,popupState:t.savePopupState,prescriptionListByWeek:t.prescriptionListByWeek},on:{templateSavePopClose:t.templateSavePopClose}}),e("TreatmentPreviewPopup",{attrs:{popupEventFlag:t.previewPopFlag,treatmentInfo:t.treatmentPreview},on:{treatmentPreviewPopClose:t.treatmentPreviewPopClose}}),e("Prescription",{ref:"prescription",attrs:{dragRemedyItem:t.dragRemedyItem},on:{treatmentPreview:t.treatmentPreviewPopOpen,templateSavePopOpen:t.templateSavePopOpen,prescriptionTemPopOpen:t.prescriptionTemPopOpen}}),e("Remedy",{on:{remedyStartDrag:t.remedyStartDrag}})],1)},a=[],r=function(){var t=this,e=t._self._c;return"Open"===t.prescriptionPopFlag?e("div",{ref:"medicineAddPopup",staticClass:"popup__wrap on"},[e("div",{staticClass:"popup__bg"}),e("div",{staticClass:"common__popup prescirption__template__popup box__shadow__02"},[e("div",{staticClass:"popup__top"},[e("h4",[t._v("처방전 템플릿 불러오기")]),e("button",{staticClass:"pop__close__btn",on:{click:t.closePopup}})]),e("div",{staticClass:"popup__main"},[e("div",{staticClass:"grid__wrap"},[e("Grid",{ref:"gridEl",staticClass:"on",attrs:{cols:t.cols,pagination:!0,sort:!0,rows:t.prescriptionTemList}})],1)])])]):t._e()},n=[],o=s(28861),p={props:{prescriptionPopFlag:String,prescriptionTemList:Array},data(){return{cols:[{name:"제목",id:"name"},{name:"설명",id:"description"},{name:"치료제 수",id:"prescriptionListByWeek",formatter:t=>{let e=0;for(let s of t)e+=s.treatmentList.length;return e}},{name:"등록자명",id:"registerName"},{name:"변경일시",id:"updateDate"},{name:"템플릿 ID",id:"pTemplateId",hidden:!0},{name:"선택",formatter:(t,e)=>this.$gridjs.h("button",{onClick:()=>{this.setPrescriptionTem(e.cells[2].data),this.closePopup()}},"선택"),sort:!1}]}},components:{Grid:o.rj},methods:{closePopup(){this.$emit("prescriptionTemPopClose","Close")},setPrescriptionTem(t){this.$emit("setPrescriptionTem",t)}}},c=p,l=s(1001),d=(0,l.Z)(c,r,n,!1,null,null,null),m=d.exports,h=s(75105),u=s(7684),g=function(){var t=this,e=t._self._c;return e("section",{staticClass:"prescription__wrap box__shadow__01 vertical__scroll"},[e("div",{staticClass:"popup__wrap",class:{on:t.loading}},[e("div",{staticClass:"popup__bg"},[e("LoadingBar",{staticClass:"loading"})],1)]),e("PrintBox",{ref:"printBox"}),e("div",{staticClass:"prescription__top"},[e("h3",{staticClass:"f__bold"},[t._v("처방전")]),e("ul",[e("li",[e("button",{staticClass:"custom__btn",on:{click:t.prescriptionUpdate}},[e("p",[t._v("처방전 저장")])])]),e("li",[e("button",{staticClass:"custom__btn",class:{off__btn:"발행"===t.status},on:{click:t.getTemplate}},[e("p",[t._v("템플릿 불러오기")])])]),e("li",[e("button",{staticClass:"custom__btn",class:{off__btn:"발행"===t.status},on:{click:t.prescriptionTemSave}},[e("p",[t._v("템플릿 저장")])])]),e("li",[e("button",{staticClass:"custom__btn",class:{off__btn:""===t.patientObj.accessCode||null===t.patientObj.accessCode||void 0===t.patientObj.accessCode},on:{click:t.prescriptionReset}},[e("p",[t._v("초기화")])])])])]),e("div",{staticClass:"prescription__middle"},[e("p",[t._v(" "+t._s(this.$route.params.name)+" ("+t._s(this.$route.params.sex)+", "+t._s(this.$route.params.age)+"세) ")]),e("div",[e("dl",[e("dt",{staticClass:"f__medium"},[t._v("치료시작일")]),e("dd",[e("input",{staticClass:"read__only yellow",attrs:{type:"text",readonly:""},domProps:{value:t.startdateInput}})])]),"발행"!==t.status?e("dl",[e("dt",{staticClass:"f__medium"},[t._v("발행일")]),e("dd",{staticClass:"calendar__wrap top"},[e("input",{staticClass:"date__input",attrs:{type:"text",readonly:""},domProps:{value:t.prescriptionDateInput}}),e("span",{staticClass:"calendar__icon",on:{click:t.calendarIconClick}},[e("img",{attrs:{src:s(53717),alt:"달력 아이콘"}})]),e("VDatePicker",{class:{active:t.calendarShow},attrs:{locale:"ko",color:"gray",value:t.prescriptionDateInput,"is-required":""},on:{input:function(e){return t.clickEndDate(e)}}})],1)]):t._e(),e("button",{staticClass:"custom__btn",class:{off__btn:"발행"===t.status},on:{click:t.prescriptionPublish}},[e("p",[t._v("처방전 발행")])]),e("button",{staticClass:"custom__btn",class:{off__btn:"발행"!==t.status},on:{click:t.runPrint}},[e("p",[t._v("출력")])])])]),e("div",{staticClass:"prescription__bottom"},t._l(t.patientObj.prescriptionListByWeek,(function(s,i){return e("div",{key:i,staticClass:"week__list__item",attrs:{"data-index":i}},[e("div",{staticClass:"title__wrap"},[e("h4",{attrs:{"data-week":i}},[t._v(t._s(i+1)+"주차")]),e("button",{staticClass:"custom__btn delete small",on:{click:function(e){return t.cleanWeekData(i)}}},[t._m(0,!0),e("p",[t._v("비우기")])])]),e("ul",t._l(s.treatmentList,(function(s,a){return e("li",{key:a,staticClass:"box__shadow__03",attrs:{"data-index":a},on:{dragover:function(e){return t.dragOver(e)},drop:function(e){return t.drop(e,"add")},dblclick:function(e){return t.treatmentPreview(s.id,s.dayNum,i+1)}}},[""===s.id?e("p",{staticClass:"day__num"},[t._v(" "+t._s(a+1)+" ")]):t._e(),""!==typeof s.id?e("dl",{attrs:{draggable:"true"},on:{dragend:function(e){return t.removeDragEnd(e)},dragover:t.removeDragOver,dragleave:function(e){return t.removeDragStart(e)}}},[e("dt",[t._v(t._s(s.categoryName))]),e("dd",[t._v(t._s(s.name))])]):t._e()])})),0)])})),0)],1)},_=[function(){var t=this,e=t._self._c;return e("span",[e("img",{attrs:{src:s(55483),alt:"삭제 아이콘"}})])}],v=(s(57658),s(4525)),C=s(27959),b=s(5886),y=s.n(b),k=s(94616),P=s(21),f={props:{dragRemedyItem:[Object,String]},data(){return{patientObj:{patientRegNumber:"",subjectId:"",prescriptionDate:"",startDate:"",startLevel:"1",prescriptionListByWeek:""},dargItemAddFlag:!1,dargItemRemoveFlag:!0,startdateInput:"",prescriptionDateInput:"",status:"",calendarShow:!1,treatmentPreviewFlag:!1,loading:!1}},watch:{dragRemedyItem(){this.dargItemAddFlag=!0}},components:{PrintBox:C.Z,VDatePicker:y(),LoadingBar:P.Z},methods:{setPrescriptionTem(t){this.patientObj.prescriptionListByWeek=this.$store.state.prescription(0),this.setPrescription(t)},getTemplate(){this.loading=!0,(0,k.L_)("","Y","").then((t=>{this.loading=!1,this.$emit("prescriptionTemPopOpen",t.data.response)})).catch((t=>this.$toast.error(t.message)))},cleanWeekData(t){"발행"===this.status?this.prescriptionNotice():(this.patientObj.prescriptionListByWeek[t].treatmentList.map(((e,s)=>{this.patientObj.prescriptionListByWeek[t].treatmentList.splice(s,1,{dayNum:1,id:"",preLearningWeekNum:null,preLearningDayNum:null,categoryName:"",name:""})})),this.treatmentPreviewFlag=!1)},calendarIconClick(){"발행"!==this.status?!1===this.calendarShow?this.calendarShow=!0:this.calendarShow=!1:this.prescriptionNotice()},prescriptionNotice(){this.$confirm({message:"이미 발행된 처방전은 편집이 불가능합니다.",button:{yes:"확인"}})},clickEndDate(t){this.patientObj.prescriptionDate=v.Z.dateToString2(t),this.setTimeInput(),this.calendarShow=!1,Number(this.patientObj.prescriptionDate)<Number(v.Z.dateToString2(new Date))&&(this.$confirm({message:"발행일을 금일 또는 이후날짜로 지정해주세요.",button:{yes:"확인"}}),this.patientObj.prescriptionDate="",this.prescriptionDateInput="")},dragOver(t){t.preventDefault()},drop(t){if("발행"===this.status)this.prescriptionNotice();else if(this.dargItemAddFlag){if(t.preventDefault(),"P"===t.path[1].childNodes[0].tagName){const e=Number(t.path[3].childNodes[0].childNodes[0].dataset.week),s=Number(t.path[1].childNodes[0].textContent)-1,i=this.patientObj.prescriptionListByWeek[e].treatmentList[s];"development"==this.$env&&console.log(i),i.id=this.dragRemedyItem.id,i.categoryName=this.dragRemedyItem.categoryName,i.name=this.dragRemedyItem.name,i.dayNum=s}this.dargItemAddFlag=!1,this.treatmentPreviewFlag=!1}},removeDragOver(){this.dargItemRemoveFlag=!0},removeDragEnd(t){if("발행"===this.status)this.prescriptionNotice();else{if(!this.dargItemRemoveFlag){const e=Number(t.path[3].dataset.index),s=Number(t.path[1].dataset.index);this.patientObj.prescriptionListByWeek[e].treatmentList.splice(s,1,{id:""})}this.treatmentPreviewFlag=!1}},removeDragStart(){this.dargItemRemoveFlag=!1},runPrint(){window.print()},setTimeInput(){null!==this.patientObj.startDate&&(this.startdateInput=this.patientObj.startDate.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")),null!==this.patientObj.prescriptionDate&&(this.prescriptionDateInput=this.patientObj.prescriptionDate.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"))},getTodayStr(){let t="";t=new Date;const e=new Date(t.setDate(t.getDate()+1));return v.Z.dateToString2(e)},prescriptionUpdate(){const t={};t.subjectId=this.patientObj.subjectId,t.prescriptionDate=null,t.startDate=null,t.startLevel=this.patientObj.startLevel;let e=[];for(let s=0;s<12;s++){let t=0,i=[];for(let e=0;e<7;e++)""!==this.patientObj.prescriptionListByWeek[s].treatmentList[e].id&&(t++,i.push(this.patientObj.prescriptionListByWeek[s].treatmentList[e]));t>=1&&e.push({treatmentList:i,weekNum:s+1})}if(t.prescriptionListByWeek=e,e.length>0)switch(this.loading=!0,this.status){case"등록":(0,k._5)(t,this.patientObj.patientRegNumber).then((t=>{this.$toast.success("처방전이 등록되었습니다"),this.patientObj.accessCode=t.data.response.accessCode,this.$route.params.accessCode=t.data.response.accessCode,this.status="수정",this.loading=!1})).catch((t=>this.$toast.error(t.message)));break;case"수정":t.accessCode=this.patientObj.accessCode,(0,k.cV)(t,this.patientObj.patientRegNumber).then((t=>{this.$toast.success("처방전이 수정되었습니다."),this.loading=!1,"development"==this.$env&&console.log(t)})).catch((t=>{this.$toast.error(t.message),"development"==this.$env&&console.log(t)}));break;case"발행":this.prescriptionNotice(),this.loading=!1;break}else this.$confirm({message:"치료제를 하나이상 등록해주세요.",button:{yes:"확인"}})},prescriptionPublish(){const t={accessCode:this.patientObj.accessCode,prescriptionDate:this.patientObj.prescriptionDate};""===t.prescriptionDate?this.$toast.error("발행일을 지정해주세요"):null!==this.patientObj.accessCode&&""!==this.patientObj.accessCode&&void 0!==this.patientObj.accessCode?(this.loading=!0,(0,k.mu)(t,this.patientObj.patientRegNumber).then((t=>{"development"==this.$env&&console.log(t),this.loading=!1,this.$toast.success("처방전이 발행되었습니다"),this.$route.params.issuedYn="Y",this.$router.push({name:"PatientDashboard",params:this.$route.params})})).catch((t=>{"development"==this.$env&&console.log(t.message)}))):this.$confirm({message:"발행 전에 편집중인 처방전을 저장해주세요.",button:{yes:"확인"}})},prescriptionReset(){this.$confirm({title:"초방전을 초기화 하시겠습니까?",message:"초기화 안내문구....",button:{no:"아니오",yes:"네"},callback:t=>{}})},treatmentPreview(t,e,s){!0===this.treatmentPreviewFlag?""!==t&&(this.loading=!0,(0,k.ve)(this.patientObj.patientRegNumber,s,e).then((t=>{this.loading=!1,this.$emit("treatmentPreview",t.data.response),"development"==this.$env&&console.log(t)})).catch((t=>{this.$toast.error(t.message),"development"==this.$env&&console.log(t),this.loading=!1}))):(this.$confirm({message:"치료제 미리보기는 처방전을 발행후 가능합니다.",button:{yes:"확인"}}),this.loading=!1)},prescriptionTemSave(){this.$emit("templateSavePopOpen",this.patientObj.prescriptionListByWeek.slice())},setPrescription(t){for(let e=0;e<t.length;e++){let s=1===t.length?0:t[e].weekNum-1;for(let i=0;i<t[e].treatmentList.length;i++)null!==t[e].treatmentList[i].id&&this.patientObj.prescriptionListByWeek[s].treatmentList.map(((e,a)=>{e.dayNum===t[s].treatmentList[i].dayNum&&Object.assign(this.patientObj.prescriptionListByWeek[s].treatmentList[a],t[s].treatmentList[i])}))}}},mounted(){if(0===Object.keys(this.$route.params).length)this.$router.push({name:"PatientInquiry"});else{if(this.patientObj=Object.assign(this.patientObj,this.$route.params),null===this.patientObj.accessCode)this.status="등록",this.patientObj.prescriptionListByWeek=this.$store.state.prescription(0);else{if(this.$route.params.startDate){const t=this.$route.params.startDate;let e=t.slice(0,4),s=t.slice(4,6);s=Number(s)-1;let i=t[6]+t[7];this.patientObj.prescriptionListByWeek=this.$store.state.prescription(new Date(e,s,i).getDay())}else this.patientObj.prescriptionListByWeek=this.$store.state.prescription(0);let t;t=this.$route.params.prescriptionListByWeek.sort((function(t,e){return t.weekNum-e.weekNum})),"development"==this.$env&&console.log(this.$route.params),this.setPrescription(t),"Y"===this.patientObj.issuedYn?(this.status="발행",this.$refs.printBox.setData(this.$route.params,"알콜중독"),this.treatmentPreviewFlag=!0):this.status="수정"}this.setTimeInput()}}},D=f,L=(0,l.Z)(D,g,_,!1,null,null,null),N=L.exports,O=function(){var t=this,e=t._self._c;return e("section",{staticClass:"remedy__wrap box__shadow__01 vertical__scroll"},[t._m(0),e("div",{staticClass:"remedy__bottom"},[e("div",{staticClass:"title__wrap"},[e("h4",[t._v("카테고리")]),e("dl",[t._m(1),e("dd",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.allChecked,expression:"allChecked"}],staticClass:"custom__checkbox",attrs:{type:"checkbox",id:"checkbox01"},domProps:{checked:Array.isArray(t.allChecked)?t._i(t.allChecked,null)>-1:t.allChecked},on:{change:[function(e){var s=t.allChecked,i=e.target,a=!!i.checked;if(Array.isArray(s)){var r=null,n=t._i(s,r);i.checked?n<0&&(t.allChecked=s.concat([r])):n>-1&&(t.allChecked=s.slice(0,n).concat(s.slice(n+1)))}else t.allChecked=a},function(e){return t.categoryAllcheck(e)}]}})])])]),e("ul",{ref:"categoryList",staticClass:"category__list"},t._l(t.treatmentCategoryList,(function(s){return e("li",{key:s.index,staticClass:"f__medium",class:{on:t.selectedCategory.includes(s.codeName)},attrs:{"data-code":s.codeId},on:{click:function(e){return t.categoryClick(s.codeName)}}},[t._v(" "+t._s(s.codeName)+" ")])})),0)]),e("div",{staticClass:"remedy__list__wrap"},[e("div",{staticClass:"title__wrap"},[e("h4",[t._v("치료제")]),t.treatmentList.length>0?e("dl",[e("dt",[t._v("검색결과   :  ")]),e("dd",[t._v(t._s(t.treatmentList.length))])]):t._e()]),t.treatmentList.length>0?e("ul",{staticClass:"remedy__item__wrap"},t._l(t.treatmentList,(function(s){return e("li",{key:s.updatetime,staticClass:"box__shadow__03"},[e("dl",{attrs:{draggable:"true"},on:{dragstart:function(e){return t.startDrag(s)}}},[e("dt",[t._v(t._s(s.categoryName))]),e("dd",{staticClass:"f__medium"},[t._v(" "+t._s(s.name)+" ")])])])})),0):t._e()])])},j=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"remedy__top"},[e("h3",[t._v("치료제 조회")])])},function(){var t=this,e=t._self._c;return e("dt",[e("label",{attrs:{for:"checkbox01"}},[t._v("전체선택")])])}],w=s(45138),T=JSON.parse('[{"codeName":"동기면담","codeId":"TACA001","useYn":"Y","registerId":"jk","registerName":"제이케이","createDate":"2022-06-27 18:04:46","updateId":"jk","updaterName":"제이케이","updateDate":"2022-06-27 18:04:46","codeDesc":"A-Stop 치료제 카테고리","mainCommCode":"TACA"},{"codeName":"질환교육","codeId":"TACA002","useYn":"Y","registerId":"jk","registerName":"제이케이","createDate":"2022-06-27 18:05:31","updateId":"jk","updaterName":"제이케이","updateDate":"2022-06-27 23:53:31","codeDesc":"A-Stop 치료제 카테고리","mainCommCode":"TACA"},{"codeName":"기능분석","codeId":"TACA003","useYn":"Y","registerId":"jk","registerName":"제이케이","createDate":"2022-06-27 18:05:53","updateId":"jk","updaterName":"제이케이","updateDate":"2022-06-27 18:05:53","codeDesc":"A-Stop 치료제 카테고리","mainCommCode":"TACA"},{"codeName":"목표설정","codeId":"TACA004","useYn":"Y","registerId":"jk","registerName":"제이케이","createDate":"2022-06-27 18:06:12","updateId":"jk","updaterName":"제이케이","updateDate":"2022-06-27 18:06:12","codeDesc":"A-Stop 치료제 카테고리","mainCommCode":"TACA"},{"codeName":"행동활성화","codeId":"TACA005","useYn":"Y","registerId":"jk","registerName":"제이케이","createDate":"2022-06-27 18:06:29","updateId":"jk","updaterName":"제이케이","updateDate":"2022-06-27 18:06:29","codeDesc":"A-Stop 치료제 카테고리","mainCommCode":"TACA"},{"codeName":"인지치료","codeId":"TACA006","useYn":"Y","registerId":"jk","registerName":"제이케이","createDate":"2022-06-27 18:06:47","updateId":"jk","updaterName":"제이케이","updateDate":"2022-06-27 18:06:47","codeDesc":"A-Stop 치료제 카테고리","mainCommCode":"TACA"},{"codeName":"동기강화부스터","codeId":"TACA007","useYn":"Y","registerId":"jk","registerName":"제이케이","createDate":"2022-06-27 18:07:09","updateId":"jk","updaterName":"제이케이","updateDate":"2022-06-27 18:07:09","codeDesc":"A-Stop 치료제 카테고리","mainCommCode":"TACA"}]'),I={data(){return{itemObj:{},treatmentCategoryList:[],treatmentList:[],treatmentListBack:[],selectedCategory:[],allChecked:!1}},methods:{categoryAllcheck(t){this.selectedCategory=[],t.target.checked&&this.treatmentCategoryList.map((t=>{this.selectedCategory.push(t.codeName)})),this.treatmentFiltering()},categoryClick(t){if(this.selectedCategory.includes(t))for(let e=0;e<this.selectedCategory.length;e++)this.selectedCategory[e]===t&&(this.selectedCategory.splice(e,1),e--);else this.selectedCategory.push(t);this.selectedCategory.length===this.treatmentCategoryList.length?this.allChecked=!0:this.allChecked=!1,this.treatmentFiltering()},treatmentFiltering(){this.treatmentList=this.treatmentListBack,this.treatmentList=this.treatmentList.filter((t=>this.selectedCategory.includes(t.categoryName)))},startDrag(t){const e={};for(let s in t)e[s]=t[s];"development"==this.$env&&console.log(e),this.$emit("remedyStartDrag",e)},getTreatmentCategoryList(){this.treatmentCategoryList=T,console.log(T)},getTreatments(){this.treatmentListBack=w,this.treatmentList.forEach(((t,e)=>{t.index=e+1}))}},mounted(){this.getTreatmentCategoryList(),this.getTreatments()}},$=I,A=(0,l.Z)($,O,j,!1,null,null,null),S=A.exports,F={data(){return{dragRemedyItem:"",previewPopFlag:!1,treatmentPreview:{name:""},savePopFlag:"Close",prescriptionPopFlag:"Close",savePopupState:"등록",prescriptionListByWeek:[],prescriptionTemList:[]}},components:{Prescription:N,Remedy:S,TreatmentPreviewPopup:h.Z,TemplateSavePopup:u.Z,PrescriptionTemplatePopup:m},methods:{remedyStartDrag(t){this.dragRemedyItem=t},treatmentPreviewPopOpen(t){this.previewPopFlag=!0,Object.assign(this.treatmentPreview,t)},treatmentPreviewPopClose(){this.previewPopFlag=!1},templateSavePopOpen(t){this.prescriptionListByWeek=t,this.savePopFlag="Open"},templateSavePopClose(){this.savePopFlag="Close"},prescriptionTemPopOpen(t){this.prescriptionPopFlag="Open",this.prescriptionTemList=t},prescriptionTemPopClose(){this.prescriptionPopFlag="Close"},setPrescriptionTem(t){this.$refs.prescription.setPrescriptionTem(t)}}},B=F,x=(0,l.Z)(B,i,a,!1,null,null,null),W=x.exports}}]);
//# sourceMappingURL=50.99693c4d.js.map